<!DOCTYPE html><html><head><script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.6.5/angular.min.js"></script><script src="/test13/angular-md5.min.a372db41.js"></script><script src="/test13/jquery.min.4d62dc64.js"></script><script src="/test13/jquery.signalR.min.aa100892.js"></script><script src="http://localhost:40001/signalr/hubs"></script><style>table,td,th{border:1px solid #000}</style></head><body> <div ng-app="exampleApp"> <div ng-controller="exampleController"> <h3>POST http://localhost:40001/json/Authenticate</h3> <b>Request:</b> <pre>{{authenticateRequest | json:4 }}</pre> <b>Response:</b> <pre>{{authenticateResponse | json:4 }}</pre> <div ng-if="eventGetListRequest"> <h3>POST http://localhost:40001/json/EventGetList</h3> <b>Request:</b> <pre>{{eventGetListRequest | json:4 }}</pre> <b>Response:</b> <pre>{{eventGetListResponse | json:4 }}</pre> <div> <b>Events:</b> <table> <tr> <td>Card.Token</td> <td>Card.Name</td> <td>CardCode</td> <td>Device.Token</td> <td>Device.Name</td> <td>Issued</td> <td>Message.Code</td> <td>Message.Name</td> <td>Sender.Token</td> <td>Sender.Name</td> <td>User.Token</td> <td>User.Name</td> </tr> <tr ng-repeat="x in events"> <td>{{ x.Card.Token }}</td> <td>{{ x.Card.Name }}</td> <td>{{ x.CardCode }}</td> <td>{{ x.Device.Token }}</td> <td>{{ x.Device.Name }}</td> <td>{{ x.Date | date:'dd.MM.yy HH:mm:ss' }}</td> <td>{{ x.Message.Code }}</td> <td>{{ x.Message.Name }}</td> <td>{{ x.Sender.Token }}</td> <td>{{ x.Sender.Name }}</td> <td>{{ x.User.Token }}</td> <td>{{ x.User.Name }}</td> </tr> </table> <div> </div> <div ng-if="newEventGetListRequest"> <h3>POST http://localhost:40001/json/EventGetList with subscription for new events</h3> <b>Request:</b> <pre>{{newEventGetListRequest | json:4 }}</pre> <b>Response:</b> <pre>{{newEventGetListResponse | json:4 }}</pre> </div> <div ng-if="notificationsVisible"> <div ng-if="timeToStop > 0"><b>Notifications ({{ timeToStop }} seconds to stop working):</b></div> <div ng-if="!timeToStop"><b>Notifications (stopped):</b></div> <table> <tr> <td>Card.Token</td> <td>Card.Name</td> <td>CardCode</td> <td>Device.Token</td> <td>Device.Name</td> <td>Issued</td> <td>Message.Code</td> <td>Message.Name</td> <td>Sender.Token</td> <td>Sender.Name</td> <td>User.Token</td> <td>User.Name</td> </tr> <tr ng-repeat="x in notifications"> <td>{{ x.Card.Token }}</td> <td>{{ x.Card.Name }}</td> <td>{{ x.CardCode }}</td> <td>{{ x.Device.Token }}</td> <td>{{ x.Device.Name }}</td> <td>{{ x.Date | date:'dd.MM.yy HH:mm:ss' }}</td> <td>{{ x.Message.Code }}</td> <td>{{ x.Message.Name }}</td> <td>{{ x.Sender.Token }}</td> <td>{{ x.Sender.Name }}</td> <td>{{ x.User.Token }}</td> <td>{{ x.User.Name }}</td> </tr> </table> <div> <div ng-if="logoutRequest"> <h3>POST http://localhost:40001/json/Logout</h3> <b>Request:</b> <pre>{{logoutRequest | json:4 }}</pre> </div> </div> </div> <script>var e=angular.module("exampleApp",["angular-md5"]);e.factory("subscriber",["$rootScope","$timeout",function(e,t){var n={},o=null;return n.onMessage=function(e){n.callback(JSON.parse(e))},n.disconnect=function(){o&&(o=null,$.connection.hub.disconnected(function(){}),$.connection.hub.stop())},n.unsubscribe=function(){o&&o.server.unsubscribe()},n.subscribe=function(s){o||(n.callback=s,$.connection.hub.url="http://localhost:40001/signalr",(o=$.connection.myHub).client.onMessage=n.onMessage,$.connection.hub.start().done(function(){e.$apply(e.connected=!0),o.server.subscribe(e.UserSID)}),$.connection.hub.reconnected(function(){o.server.subscribe(e.UserSID)}),$.connection.hub.disconnected(function(){e.$apply(e.connected=!1),o&&t(function(){$.connection.hub.start().done(function(){o.server.subscribe(e.UserSID)})},5e3)}))},n}]),e.controller("exampleController",["$rootScope","$scope","$http","$timeout","md5","subscriber",function(e,t,n,o,s,i){var c,a,r;function u(e,t){t.forEach(function(t){var n=parseInt(t.Issued.substring(6));t.Date=new Date(n),e.push(t)})}function p(e){e.Event&&(u(t.notifications,e.Event),t.$apply())}function h(){i.unsubscribe(),i.disconnect(),t.logoutRequest={UserSID:t.UserSID},n.post("http://localhost:40001/json/Logout",t.logoutRequest)}function l(){t.timeToStop&&(t.timeToStop--,o(l,1e3))}t.events=[],t.notifications=[],t.UserSID="",t.timeToStop=30,t.highestEventToken=0,c="admin",a="admin",r=s.createHash(s.createHash(s.createHash(a).toUpperCase()+"F593B01C562548C6B7A31B30884BDE53").toUpperCase()).toUpperCase(),t.authenticateRequest={UserName:c,PasswordHash:r},n.post("http://localhost:40001/json/Authenticate",t.authenticateRequest).then(function(s){t.authenticateResponse=s.data,t.UserSID=s.data.UserSID,e.UserSID=s.data.UserSID,""!=t.UserSID&&function e(s,c){t.eventGetListRequest={UserSID:t.UserSID,Limit:-1,StartToken:c},n.post("http://localhost:40001/json/EventGetList",t.eventGetListRequest).then(function(c){var a;t.eventGetListResponse=c.data,c.data.Event.forEach(function(e){t.highestEventToken<e.Token&&(t.highestEventToken=e.Token)}),u(t.events,c.data.Event),console.log(s),s>1?e(s-1,c.data.NextToken):(a=c.data.Event?c.data.Event[0].Token+1:0,i.subscribe(p),t.newEventGetListRequest={UserSID:t.UserSID,Limit:0,StartToken:a,SubscriptionEnabled:!0},n.post("http://localhost:40001/json/EventGetList",t.newEventGetListRequest).then(function(e){t.notificationsVisible=!0,t.newEventGetListResponse=e.data,o(l,1e3),o(h,1e3*t.timeToStop)},function(e){t.newEventGetListResponse="Event subscription error"}))},function(e){t.eventGetListResponse="Event loading error"})}(2,0)},function(e){t.authenticateResponse="Authentication error"})}]);</script> </div></div></div></div></body></html>